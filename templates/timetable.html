<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>View Timetable</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f7f9fc;padding:30px}
    h1{text-align:center}
    table{width:95%;margin:10px auto;border-collapse:collapse;background:#fff;box-shadow:0 4px 8px rgba(0,0,0,0.08)}
    th,td{padding:10px;border:1px solid #e6e6e6;text-align:center}
    th{background:#4e79a7;color:#fff}
    a{display:block;width:150px;margin:20px auto;text-align:center;padding:10px;background:#4e79a7;color:#fff;text-decoration:none;border-radius:6px}
  </style>
</head>
<body>
  <h1>Generated Timetable</h1>
  <table>
    <thead>
      <tr>
        <th>Year</th><th>Section</th><th>Subject</th><th>Faculty</th><th>Room</th><th>Day</th><th>Start</th><th>End</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td colspan="8">Loading...</td></tr>
    </tbody>
  </table>
  <a href="/">← Back to Dashboard</a>

  <script>
    fetch('/timetable_data')
      .then(r => r.json())
      .then(data => {
        const tbody = document.getElementById('tbody');
        tbody.innerHTML = '';
        if (data.status === 'empty') {
          tbody.innerHTML = `<tr><td colspan="8">${data.message}</td></tr>`;
          return;
        }
        if (data.status === 'error') {
          tbody.innerHTML = `<tr><td colspan="8">Error: ${data.message}</td></tr>`;
          return;
        }
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${row.year||''}</td>
                          <td>${row.section||''}</td>
                          <td>${row.subject_name||''}</td>
                          <td>${row.faculty_name||''}</td>
                          <td>${row.room_name||''}</td>
                          <td>${row.day_of_week||''}</td>
                          <td>${row.start_time||''}</td>
                          <td>${row.end_time||''}</td>`;
          tbody.appendChild(tr);
        });
      })
      .catch(err => {
        const tbody = document.getElementById('tbody');
        tbody.innerHTML = `<tr><td colspan="8">⚠️ Error fetching timetable data.</td></tr>`;
      });
  </script>
</body>
</html>
